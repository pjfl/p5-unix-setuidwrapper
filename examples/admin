#!/usr/bin/env perl

# Run once as root with
#   perl examples/admin -nc init_suid_wrapper
# Thereafter run as a normal user
#   perl examples/admin -nc test_cmd

use lib;
use strict;
use warnings;

use FindBin qw( $Bin );
use File::Spec::Functions qw( catdir updir );

lib->import( catdir( $Bin, updir, 'lib' ) );

package Admin;

use namespace::autoclean;

use English qw( -no_match_vars );
use Moo;

extends q(Class::Usul::Programs); # Framework for command line programs
with    q(Unix::SetuidWrapper);

our $VERSION = '0.1';

sub test_cmd : method {
   my $self = shift; $self->info( "User id $EFFECTIVE_USER_ID" ); return 0;
}

$INC{ 'Admin' } = __FILE__;

package main;

use Admin;

$ENV{ENV} = '${START[(_$- = 1)+(_ = 0)-(_$- != _${-%%*i*})]}';

my $app = Admin->new_with_options
   (  config => { tempdir => 't', vardir => 't' }, noask  => 1, );

$app->is_uid_zero or exec $app->wrapped_cmdline or exit 1;

exit $app->run;
